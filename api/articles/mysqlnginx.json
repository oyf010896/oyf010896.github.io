{"title":"mysql通过nginx进行映射","slug":"mysqlnginx","date":"2022-07-29T03:13:29.000Z","updated":"2022-07-29T04:08:29.097Z","comments":true,"path":"api/articles/mysqlnginx.json","photos":[],"link":"","excerpt":null,"covers":null,"content":"<h4 id=\"mysql通过nginx进行映射\"><a href=\"#mysql通过nginx进行映射\" class=\"headerlink\" title=\"mysql通过nginx进行映射\"></a>mysql通过nginx进行映射</h4><p>背景：现在nginx1.9以上版本才支持，安装请见nginx平滑升级</p>\n<p>注意编译的时候加上–with-stream </p>\n<p>配置文件配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/local/nginx/stream/mysql.cnf</span><br><span class=\"line\">stream &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    upstream mysql &#123;</span><br><span class=\"line\">        server 数据库IP:3306(数据库端口) weight=1 max_fails=3 fail_timeout=30s;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        listen 3007（映射端口）;</span><br><span class=\"line\">        proxy_connect_timeout 10s;</span><br><span class=\"line\">        proxy_timeout 30s;</span><br><span class=\"line\">        proxy_pass mysql;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p>nginx重载</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure>\n\n","categories":[],"tags":[]}